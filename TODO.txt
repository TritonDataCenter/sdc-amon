# MVP

"The absolute MVP for Monitoring is having the ability to alert when a
VM or Zone goes down, and the ability to alert someone via email." -- Trevor

More specific MVP:
- Amon is up an running in a default SDC setup (modulo headnode-refactor work).
  Details: 'amon' headnode zone running amon-master. 'amonriak' headnode
  zone. 'amon-relay' running in each compute node GZ.
  Q: Unsure whether getting an amon-agent running in each zone is necessary.
  A: If only requirement is zone/vm start/stop, then don't need agent in zone.
  Q: Also what about amon-agent in VMs? That would have to be optional and not feasible for Windows right now.
  A: Punt for SDC 6.5.
- Amon can be setup to email an operator when a VM or Zone goes down.
  Q: distinguishing between intentional reboots and shutdowns?
  A:
  Q: required to guard against email flood on *server* shutdown?
  A:
- Docs on adding more amonriak nodes.
- Docs on setting up the notifications above.

Internal requirements for first release:
- Upgradeable:
  - db migration story
  - amon-master upgrade story
  - amon-relay upgrade story
  - amon-agent install/upgrade story
- Test suite with decent coverage.
- Load testing.


# SDC 6.5

Remaining days. Fixed holidays, milestones and non-amon work "[in brackets]".
Proposed target functionality/work for the other days. Note that John has
offered to do some work on amon if feasible.

- Tue,  9 Aug: Hack up watching zone start/stop and vm start/stop. Grokking Riak models and indexing.
- Wed, 10 Aug: Test plan for zone/vm start/stop in COAL. Test cases. Clean up test suite.
- Thu, 11 Aug: [Nectarine] Email notification plugin. Amon-master and amon-relay builds (bamboo, mountain-gorilla).
- Fri, 12 Aug: Amon-master and amon-relay builds (bamboo, mountain-gorilla).
- Mon, 15 Aug: amon & amonriak headnode zones (using Jerry's headnode-refactor process)
- Tue, 16 Aug: [Trent on Lime-no.de upgrade.]
- Wed, 17 Aug: [Lime-no.de updated. Trent on Lime-no.de upgrade.] 
- Thu, 18 Aug: More headnode zones work. Upgrade plan. 
- Fri, 19 Aug: Finish upgrading impl.
- Mon, 22 Aug: [Trent DSAPI work.]
- Tue, 23 Aug: [Trent DSAPI work.]
- Wed, 24 Aug: [Trent vacation]
- Thu, 25 Aug: [Olive] Retry/backoff everywhere (restify). 
- Fri, 26 Aug: [Trent vacation]
- Mon, 29 Aug: Amon load testing and test suite improvements. Amon db garbage collection.
- Tue, 30 Aug:
- Wed, 31 Aug: [Trent vacation]
- Thu,  1 Sep: [cutoff day (morning)]
- Fri,  2 Sep: [Trent vacation]
- Mon,  5 Sep: [Public holiday (Labour day)]
- Tue,  6 Sep:
- Wed,  7 Sep:
- Thu,  8 Sep: [Papaya, SDC 6.5 release]

Workdays left: 14 days (starting at 9-Aug) - 2 days lost to no.de help (at least).



# TODOs for MVP

- Build/install (usb-headnode, bamboo, mountain-gorilla):
  - riak: discuss with others if separate riak clusters for separate apps
    or one shared one? billing/amon/hostrouter(?)/capi
  - master
  - relay (SMF packaging done; bamboo started)
  - agent
  - package.json: get specific about included versions
- Email Notification Plugin
- Retry/backoff everywhere: Restify-client supports everything needed here?
- event on zone/vm transitions: use zwatch
  - what does it mean to design to have events coming NOT from amon-agent
- Garbage collection of /events and orphans
- in riak, use uuid instead of customer_name for keys, if possible
- load testing (hook into mock cloud for this?)
  - estimate of design-limit on number of watches/notifications/events
  - e.g., what would it be on no.de
- upgrade plan and testing
  - versioning (see ca/Makefile, and 1.0.0 instead of 6.1)
  - config handling



# Post-6.5 TODOs and RFEs

- amon-agent in all smartos zones
- *trying* with a second riak node
- CA Agent Plugin
- HTTP Agent Plugin
- revive twillio notification backend as "sms"
- Default to CAPI lookup user email on no contacts
- missing data alarms in master: ???
- edge-triggered alarms in master for checks: ???
- /events cleanup (look like other master apis)
- client SDK
- s/joyent/sdc/ in various runtime files and dirs
- Admin UI
- amon client
- snmp (MarkC: "snmp traps". Me: What's that?)
